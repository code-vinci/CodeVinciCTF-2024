from Crypto.Util.number import bytes_to_long, long_to_bytes, getPrime
from Crypto.Util.Padding import pad
from Crypto.Cipher import DES
from string import ascii_letters, digits
from random import randint
from sympy import root


FLAG = "a6ecb4300a5090fb6b005016601f732661b68c13fee10c8da41b55cfe779c3184bb0cff83563ffb1"
KEY = "051b1129960df4135e28739c09620ea9bb012e4c368df02ad304090aa0085d18a87c01b61786d586836f03f76b52db4a4d16aed0000000"
e = 7


def decryptFlag(key, encrypted_Flag):
    key = long_to_bytes(bytes_to_long(str(key).encode())).hex()
    key = bytes.fromhex(key)
    iv = key[::-1]
    helper = DES.new(key=key, mode=DES.MODE_CBC,iv=iv)
    p = helper.decrypt(bytes.fromhex(encrypted_Flag))
    return p.decode()

def decryptKey(key):
    n = bytes_to_long(bytes.fromhex(key))
    key = long_to_bytes(root(n,e))
    return key.decode()

dropped_flag = decryptFlag(decryptKey(KEY), FLAG)

lista = []
for i in  range(0,len(dropped_flag),4):
    l = []
    for j in range(4):
        l.append(dropped_flag[i+j])
    lista.append(l)
flag=""
for x in lista:
    x = list(x)  
    x[0], x[len(x)-1] = x[len(x)-1], x[0]  
    flag += "".join(x) 
print(flag)
